<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Attendance</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        video, canvas {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 1rem auto;
            border-radius: 8px;
            box-shadow: 0 0 8px rgba(0,0,0,0.1);
        }

        #user-photo {
            display: block;
            margin: 1rem auto;
            border-radius: 10px;
            border: 2px solid #333;
            width: 200px;
            height: 150px;
            object-fit: cover;
        }

        #capture {
            display: block;
            margin: 1.5rem auto;
            padding: 0.75rem 1.5rem;
            font-size: 1.25rem;
            min-width: 180px;
        }

        .user-info {
            text-align: center;
            font-size: 1.125rem;
            margin-top: 1.5rem;
        }

        .logout {
            text-align: center;
            margin-top: 1rem;
        }
        .logout a {
            color: #dc3545;
            font-weight: 600;
            text-decoration: none;
            font-size: 1.125rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .logout a:hover {
            color: #a71d2a;
            text-decoration: underline;
        }
    </style>
</head>
<body>

<div class="container py-4">

    <h2 class="text-center mb-4">Face Attendance</h2>

    <div class="user-info">
        Logged in as: <strong>{{ session['user'] }}</strong>
    </div>

    <img 
        id="user-photo" 
        src="{{ url_for('static', filename='faces/' + session['user'] + '.jpg') }}" 
        alt="Your Registered Face" 
        onerror="this.style.display='none';" 
        class="mx-auto"
    />

    <div class="logout">
        <a href="{{ url_for('logout') }}">ðŸ”“ Logout</a>
    </div>

    <!-- Meeting and Room Selection -->
    <div class="row mb-3">
        <div class="col-md-6">
            <label for="meeting" class="form-label">Select Meeting</label>
            <select id="meeting" class="form-select" required>
                <option value="">-- None --</option>
                {% for meeting in meetings %}
                    <option value="{{ meeting.id }}" data-room="{{ meeting.room_id }}"
                        {% if meeting.id == selected_meeting_id %}selected{% endif %}>
                        {{ meeting.title }} â€” Start: {{ meeting.start_time }} â€” End: {{ meeting.end_time }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-6">
            <label for="room" class="form-label">Select Room <span class="text-danger">*</span></label>
            <select id="room" class="form-select" required>
                <option value="">-- Select Room --</option>
                {% for room in rooms %}
                    <option value="{{ room.id }}"
                        {% if selected_room_id and room.id == selected_room_id %}selected{% endif %}>
                        {{ room.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
    </div>

    <video id="video" autoplay playsinline class="mx-auto rounded shadow-sm"></video>

    <button id="capture" class="btn btn-primary btn-lg">Mark Attendance</button>

    <canvas id="canvas" style="display:none;"></canvas>

</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='js/attendance.js') }}"></script>

</body>
</html>


